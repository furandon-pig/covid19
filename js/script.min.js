let gData,gRegions=[];const LANG=$("html").attr("lang"),REGION_THRESHOLD=10,COLORS={default:"#3DC",dark:"#399",patient:"#ED9",discharge:"#3CA",test:"#3DC",dead:"#E95",positive:"#E95",selected:"#EC2",gender:{f:"#FE9",m:"#2B9"}},LABELS={ja:{chart:{patients:{dead:"死亡数",discharge:"退院数",patient:"患者数"},surveys:{patient:"有症数",positive:"陽性者数",test:"検査数"},demography:{f:"女性",m:"男性"}},age:{"10代":"10代","20代":"20代","30代":"30代","40代":"40代","50代":"50代","60代":"60代","70代":"70代","80代":"80代","90代":"90代","10歳未満":"10歳未満"}},en:{chart:{patients:{dead:"Deaths",discharge:"Discharged",patient:"Cases"},surveys:{patient:"Cases",positive:"Positive",test:"PCR Tests"},demography:{f:"Female",m:"Male"}},age:{"10代":"10s","20代":"20s","30代":"30s","40代":"40s","50代":"50s","60代":"60s","70代":"70s","80代":"80s","90代":"90s","10歳未満":"Under 10"}}},STOPCOVID_URLS={"北海道":"https://stopcovid19.hokkaido.dev/","青森県":"","岩手県":"","宮城県":"","秋田県":"","山形県":"","福島県":"","茨城県":"","栃木県":"","群馬県":"https://covid19-gunma.com/","埼玉県":"https://stopcovid19.e-toda.jp/","千葉県":"https://chiba-covid19.mypl.net/","東京都":"https://stopcovid19.metro.tokyo.lg.jp/about","神奈川県":"https://www.pref.kanagawa.jp/osirase/1369/","新潟県":"","富山県":"","石川県":"","福井県":"","山梨県":"https://stopcovid19.yamanashi.dev/","長野県":"https://stop-covid19-nagano.netlify.com/","岐阜県":"https://covid19-gifu.netlify.com/","静岡県":"","愛知県":"https://stopcovid19.code4.nagoya/","三重県":"https://covid19-mie.netlify.com/","滋賀県":"","京都府":"","大阪府":"https://covid19-osaka.info/","兵庫県":"https://stop-covid19-hyogo.org/","奈良県":"https://stopcovid19.code4nara.org/","和歌山県":"","鳥取県":"","島根県":"","岡山県":"https://okayama.stopcovid19.jp/","広島県":"","山口県":"https://yamaguchi.stopcovid19.jp/","徳島県":"","香川県":"https://covid19-kagawa.netlify.com/","愛媛県":"https://ehime-covid19.com/","高知県":"https://covid19-kochi.netlify.com/","福岡県":"","佐賀県":"","長崎県":"","熊本県":"","大分県":"","宮崎県":"","鹿児島県":"https://covid19.codeforkagoshima.dev/","沖縄県":""},init=()=>{const t=()=>{let t=$("#patients-chart");t.empty(),t.html("<canvas></canvas>");let a=t.find("canvas")[0],e=$("#patients-block").find(".switch.selected").attr("value"),o="total"===e,s={type:"bar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.patients.dead,backgroundColor:COLORS.dead,borderColor:COLORS.dead,data:[]},{label:LABELS[LANG].chart.patients.discharge,backgroundColor:COLORS.discharge,borderColor:COLORS.discharge,data:[]},{label:LABELS[LANG].chart.patients.patient,backgroundColor:COLORS.patient,borderColor:COLORS.patient,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function(t){let a=t[0].xLabel+" "+gData.transition[t[0].index][2]+":00";return{ja:"",en:"As of "}[LANG]+a+{ja:{total:"時点 累計",new:"時点新規"},en:{total:" Total",new:" New cases"}}[LANG][e]},label:function(t,a){let o,s=gData.transition[t.index],n={ja:"名",en:""};if("new"===e&&t.index>=1){const a=gData.transition[t.index-1];o=[LABELS[LANG].chart.patients.patient+": "+(s[5]-a[5])+n[LANG],LABELS[LANG].chart.patients.discharge+": "+(s[6]-a[6])+n[LANG],LABELS[LANG].chart.patients.dead+": "+(s[7]-a[7])+n[LANG]]}else o=[LABELS[LANG].chart.patients.patient+": "+s[5]+n[LANG],LABELS[LANG].chart.patients.discharge+": "+s[6]+n[LANG],LABELS[LANG].chart.patients.dead+": "+s[7]+n[LANG]];return o}}},scales:{xAxes:[{stacked:o,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,zeroLineColor:"rgba(255,255,255,0.7)",color:"rgba(255, 255, 255, 0.3)"},ticks:{beginAtZero:!0,fontColor:"rgba(255,255,255,0.7)",callback:function(t,a,e){return t.toString()}}}]}}};"new"===e&&(s.type="line",s.data.datasets.forEach((function(t){t.fill=!1,t.lineTension=.1,t.pointBackgroundColor="#242a3c",t.pointBorderWidth=1.5,t.pointRadius=2.5,t.borderWidth=4}))),t.width()>=400&&(s.options.aspectRatio=1.5),t.width()>=600&&(s.options.aspectRatio=1.8),gData.transition.forEach((function(t,a){if(s.data.labels.push(t[0]+"/"+t[1]),"new"===e&&a>=1){let e=gData.transition[a-1];s.data.datasets[2].data.push(t[5]-e[5]),s.data.datasets[1].data.push(t[6]-e[6]),s.data.datasets[0].data.push(t[7]-e[7])}else s.data.datasets[2].data.push(t[5]),s.data.datasets[1].data.push(t[6]),s.data.datasets[0].data.push(t[7])}));let n=a.getContext("2d");window.myChart=new Chart(n,s)},a=()=>{let t=$("#surveys-chart");t.empty(),t.html("<canvas></canvas>");let a=t.find("canvas")[0],e=$("#surveys-block").find(".switch.selected").attr("value"),o="total"===e,s={type:"bar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.surveys.patient,backgroundColor:[],borderColor:COLORS.patient,data:[]},{label:LABELS[LANG].chart.surveys.positive,backgroundColor:[],borderColor:COLORS.positive,data:[]},{label:LABELS[LANG].chart.surveys.test,backgroundColor:[],borderColor:COLORS.test,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function(t){let a=t[0].xLabel+" "+gData.transition[t[0].index][2]+":00";return{ja:"",en:"As of "}[LANG]+a+{ja:{total:"時点 累計",new:"時点新規"},en:{total:" Total",new:" New cases"}}[LANG][e]},label:function(t,a){let o,s=gData.transition[t.index],n={ja:"名",en:""};if("new"===e&&t.index>=1){const a=gData.transition[t.index-1];""!==a[3]&&(o=[LABELS[LANG].chart.surveys.test+": "+(s[3]-a[3])+n[LANG],LABELS[LANG].chart.surveys.positive+": "+(s[4]-a[4])+n[LANG],LABELS[LANG].chart.surveys.patient+": "+(s[5]-a[5])+n[LANG]])}else o=[LABELS[LANG].chart.surveys.test+": "+s[3]+n[LANG],LABELS[LANG].chart.surveys.positive+": "+s[4]+n[LANG],LABELS[LANG].chart.surveys.patient+": "+s[5]+n[LANG]];return o}}},scales:{xAxes:[{stacked:o,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,zeroLineColor:"rgba(255,255,255,0.7)",color:"rgba(255, 255, 255, 0.3)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(t,a,e){return t.toString()}}}]}}};"new"===e&&(s.type="line",s.data.datasets.forEach((function(t){t.fill=!1,t.lineTension=.1,t.pointBackgroundColor="#242a3c",t.pointBorderWidth=1.5,t.pointRadius=2.5,t.borderWidth=4}))),t.width()>=400&&(s.options.aspectRatio=1.5),t.width()>=600&&(s.options.aspectRatio=1.8),gData.transition.forEach((function(t,a){if(s.data.labels.push(t[0]+"/"+t[1]),"new"===e&&a>=1){let e=gData.transition[a-1];s.data.datasets[2].data.push(t[3]-e[3]),s.data.datasets[1].data.push(t[4]-e[4]),s.data.datasets[0].data.push(t[5]-e[5])}else s.data.datasets[2].data.push(t[3]),s.data.datasets[1].data.push(t[4]),s.data.datasets[0].data.push(t[5]);let o=t[0]>=3&&t[1]>=4?COLORS.dark:COLORS.test;s.data.datasets[2].backgroundColor.push(o),s.data.datasets[1].backgroundColor.push(COLORS.positive),s.data.datasets[0].backgroundColor.push(COLORS.patient)}));let n=a.getContext("2d");window.myChart=new Chart(n,s)},e=t=>{let a="rgba(90, 90, 90, 0.3)";return t>=1&&(a=COLORS.dark),t>=10&&(a=COLORS.default),a},o=t=>{let a=$("#region-chart");a.empty(),a.html("<canvas></canvas>");let o=a.find("canvas")[0],s={type:"horizontalBar",data:{labels:[],datasets:[{label:"",backgroundColor:[],data:[]}]},options:{aspectRatio:.6,animation:{duration:1e3},responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(t){return t[0].yLabel},label:function(t,a){return t.xLabel+{ja:" 名",en:" cases"}[LANG]}}},scales:{xAxes:[{position:"top",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(t,a,e){return t.toString()}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};a.outerWidth()>=400&&(s.options.aspectRatio=.8),a.outerWidth()>=600&&(s.options.aspectRatio=1),""!==t&&(s.options.animation.duration=0),gData.prefectures.forEach((function(a,o){a.value>=1&&(s.data.labels.push(a[LANG]),s.data.datasets[0].data.push(a.value),t===a.code?s.data.datasets[0].backgroundColor.push(COLORS.selected):s.data.datasets[0].backgroundColor.push(e(a.value)))}));let n=o.getContext("2d");window.myChart=new Chart(n,s)};$.getJSON("https://raw.githubusercontent.com/kaz-ogiwara/covid19/master/data/data.json",(function(s){gData=s,a(),t(),(()=>{$wrapper=$("#demography-chart"),$wrapper.empty(),$wrapper.html("<canvas></canvas>"),$canvas=$wrapper.find("canvas")[0];let t={type:"horizontalBar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.demography.f,backgroundColor:COLORS.gender.f,data:[]},{label:LABELS[LANG].chart.demography.m,backgroundColor:COLORS.gender.m,data:[]}]},options:{aspectRatio:.9,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(t){return t[0].yLabel},label:function(t,a){return a.datasets[t.datasetIndex].label+": "+t.value+{ja:"名",en:""}[LANG]}}},scales:{xAxes:[{position:"top",color:"yellow",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(t,a,e){return t.toString()}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)",callback:function(t){return LABELS[LANG].age[t]}}}]}}};$wrapper.outerWidth()>=400&&(t.options.aspectRatio=1.1),$wrapper.outerWidth()>=600&&(t.options.aspectRatio=1.3);let a=0;for(let e in gData.demography){for(let o in gData.demography[e]){let s=gData.demography[e][o];0===a&&t.data.labels.push(o),t.data.datasets[a].data.push(s)}a++}let e=$canvas.getContext("2d");window.myChart=new Chart(e,t)})(),(()=>{const t=$("#japan-map").width();let a=[];gData.prefectures.forEach((function(t,o){a.push({code:t.code,jp:t.jp,en:t.en,color:e(t.value),hoverColor:COLORS.selected,prefectures:[t.code]})})),$("#japan-map").japanMap({areas:a,width:t,borderLineColor:"#fcfcfc",borderLineWidth:.25,lineColor:"#ccc",lineWidth:1,drawsBoxLine:!1,showsPrefectureName:!1,movesIslands:!0,fontSize:11,onHover:function(t){""!==STOPCOVID_URLS[t.name]?$("#info_cursor").css("display","block"):$("#info_cursor").css("display","none"),o(t.code,0)},onSelect:function(t){""!==STOPCOVID_URLS[t.name]&&(window.open(STOPCOVID_URLS[t.name]),$("#info_cursor").css("display","none"))}}),$("#japan-map").mousemove((function(t){$("#info_cursor").offset({top:t.pageY+10,left:t.pageX+10}),"default"===$("#japan-map").children("canvas").css("cursor")&&$("#info_cursor").css("display","none")}))})(),o(""),["last","transition","demography","prefectures"].forEach((function(t){$(".updated-"+t).text(gData.updated[t][LANG])})),$("#container").addClass("show")})),$(".switch").on("click",(function(){$(this).siblings(".switch").removeClass("selected"),$(this).addClass("selected"),$(this).closest("#patients-block")[0]&&t(),$(this).closest("#surveys-block")[0]&&a()}))};$((function(){init()}));
